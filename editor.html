<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
        <title></title>
        <style>
#content {
    position: fixed;
    left: 0; right: 0; top: 0; bottom: 2cm;
    background: #FAFFF0;
    overflow-x: hidden;
    overflow-y: auto;
    padding: 0.25cm;
}
#image_upload {
    display: none;
}
#image_upload_button {
    position: fixed;
    right: 0.25cm; bottom: 0.25cm; width: 1cm; height: 1cm;
    padding: 0.25cm;
    border-radius: 50%;
    background: #81d8d0;
}
        </style>
    </head>
    <body>
        <div id='content' contenteditable></div>
        <input type="file" id='image_upload' accept="image/*"/>
        <img id="image_upload_button" src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAQAAAD41aSMAAAEYUlEQVR4Ae3YX4uU9R+H8U+L4e6kQWsPIF21moOkv88g0upU0bOBjSKIqEewRSEonkZrO9k8iv4g0eHCUpjRnFTQr99JrFoaOOWMa1cHGU3t3He7c899j9+Z63o/g33Bfu/PhJmZmZmZmZmZmZmZmZmZmZmZ2aDYzQlWWOMKPSa9HpdZY4Xj7CaKLyi6g5zjV6axDk32jxdgjjPcZJrrcZrZcQEc4GsMLrIwDoBHucSf2TqHqgY4wCX6k2ChSoDapn8+dpHZ6gDOsDk7VRXAQW6yOeuxUA3AOWxwK1UA3Jt5dtl1dpUPcILs7Fj5ACtkZ8vlA6yRna2WD3CF7Gy9fIAe2Vm3fID8TAABJjsBBDABBDABBDABBDABBDABBDABBDABBDABBJjsBBDABBDABBDABBDABBDABBDABBDABBDABBBgshNAABNAABNAABNAABNAABNAABNAABNAABNAgDuxJi0BxtcXzFKjLcB4+okHCII6HQGq7xZHiNtrCFB9bxB9awlQbR8xQ/StRluA6vqeeeJfq9MRoJpu8DgxYA0BqukFImMtAcrvfSJzNdoClH96Rc7qdAQor5/ZS5C/hgD9NXmHUfU7zxJbWEuAv/qcnezgPKPpTWJLq9EWoP+3mvv4huJ9zAyxxdXpCHCLw8TtPchVivU/5oltrCHAEtG3p7lZ6PR6gtjmWtMN8CF3EfTvFYbvRWLbq9GeQoCc32qCdxmuD4ihVqcznQC/8RgxYDv4lO13gTliyDWmE2CRyNg837K9rrKPKLDW9AE0iZw9xLVtnV7PEYVWo50aQPHTK3L3DBtstbeIwqvTSRSgwOmVv1fZWp8wQxQfjWQBCpxe+TvLf/cDe4gRrTUdAEvEFnc3n5HfDZ4kRrYa7UQBCpxe+ZvnO/J6iRjp6nQSBShweuXvYa6RVYsY+RrJAhQ4vfJ3mA0G9SVzRAlrTS7AIjHUXit+ehV/CdIHaBJD771Np9fzRGmr00kPoMDpNcT30NtEqWskC5B/ehXYnr7vofPMECWvlSxA/ulVYHV+AeD/3E+UvhrtyQFYIkayI2zQ5SmiktXpJAuQf3oV2Ou8TFS2RvIA+adXAmslDpB/eiWwGu20ARaJxFenky5Ak5iANVIFyD+9UlorCYD80yv1lyABgPzTK/2XIC2AJWLC1kgJIP/0SnWtBADyT6/0X4IUAAqdXum/BOMHWCQmeI3xA5gAApgAApgAApgA0wfQIzvrlg9wmexsvXyANbKz1fIBVsjOlssHOE52drR8gN10GJxd557yAYImg7OzRBUA++lhm+uyrxqA4DS2uZNEVQBzfIX9swvsrA4gWGAd+7sf2UtUCRAc6iPwz/8IUTVAsMBFDC6wlxgHQDDLKXpMc11OspMoFyB/C6xwfUrPrrPsI4otGMV2cYxlVlmny6TXZZ1Vljmac/VWA+DuUAAngABOAAGcAAI4AQRwAgjgBBDACSCAE0AAJ4AATgABnAACuD8AX/XJwH1L6xUAAAAASUVORK5CYII='></img>
        <script type="text/javascript">
window.onload = function() {
    'use strict';

    var listener = null;
    var range = new Range();
    range.setStart(content, 0);
    range.setEnd(content, 0);

    content.onfocus = function() {
        listener = setInterval(function() {
            range = window.getSelection().getRangeAt(0);
        }, 100)
    }
    content.onblur = function() {
        clearInterval(listener);
    }
    function insertFile(file) {
        var img = document.createElement('img');
        img.src = window.URL.createObjectURL(file);
        img.style.width = 'calc(100vw - 0.5cm)';
        img.style.height = 'auto';
        img.style.borderRadius = '0.25cm';
        img.onclick = function() {
            content.focus();
            range.setStartAfter(img);
        };
        range.insertNode(img);
        range.setStartAfter(img);
    }
    image_upload_button.onclick = function() {
        image_upload.click();
    };
    image_upload.onchange = function() {
        console.log(image_upload.files)
        for(var i = 0; i < image_upload.files.length; i++) {
            insertFile(image_upload.files[i]);
        }
        image_upload.value = null;
    }
};
        </script>
    </body>
</html>
